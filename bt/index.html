
<!DOCTYPE html>
<html lang="zh-CN">
<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>磁力解析</title>
    <link href="style.css" media="screen" rel="stylesheet" type="text/css" />
    
    <!-- Bootstrap -->
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim 和 Respond.js 是为了让 IE8 支持 HTML5 元素和媒体查询（media queries）功能 -->
    <!-- 警告：通过 file:// 协议（就是直接将 html 页面拖拽到浏览器中）访问页面时 Respond.js 不起作用 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
	    .header{
		    margin-top:10%;
	    }
	    .main{
		    padding:10px 15%;
	    }
	    .footer{
		    padding:10px 15%;
	    }
    </style>
<body>
	<div class="container">
	    <div class="header h1 text-center">
		    <h1>磁力解析</h1>
		    <small>输入磁力地址即可播放</small>
	    </div>
	    <hr />
	    <div class="main">
			<form class="form-horizontal" method="post" name="myform">
			  <div class="form-group">
			    <label for="url" class="col-sm-2 control-label">磁力地址</label>
			    <div class="col-sm-10">
			      <input type="url" class="form-control" id="url" name="url" placeholder="magnet:?xt=" value="magn">
			    </div>
			  </div>
			  <div class="form-group">
			    <div class="col-sm-offset-2 col-sm-10">
			      <button type="button" id="play" class="btn btn-primary">播 放</button>
			    </div>
			  </div>
			</form>
			</div>
			<hr />
			
		<script>

          $("#play").click(function(){

			$url = $("#url").val();
			if($url == "" || $url == null || !/^magnet.*$/.test($url)){
				alert('地址不正确！请输入磁力地址！');
				return;
			}
			
			window.webtor = window.webtor || [];
        	window.webtor.push({

            id: 'player',
            magnet: myform.url.value,
            width: '100%',
            
            
            on: function(e) {
                if (e.name == window.webtor.TORRENT_FETCHED) {
                    console.log('Torrent fetched!', e.data);
                }
                if (e.name == window.webtor.TORRENT_ERROR) {
                    console.log('Torrent error!');
                }
            },
            poster: 'https://via.placeholder.com/150/0000FF/808080',
            subtitles: [
                {
                    srclang: 'en',
                    label: 'test',
                    src: 'https://raw.githubusercontent.com/andreyvit/subtitle-tools/master/sample.srt',
                    default: false,
                }
            ],
            lang: 'en',
            i18n: {
                en: {
                    common: {
                        "prepare to play": "Preparing Video Stream... Please Wait...",
                    },
                    stat: {
                        "seeding": "Seeding",
                        "waiting": "Client initialization",
                        "waiting for peers": "Waiting for peers",
                        "from": "from",
                    },
                },
            },
        	});


			});
        
    
    	</script>
    	<script src="https://cdn.jsdelivr.net/npm/@webtor/embed-sdk-js/dist/index.min.js" charset="utf-8" async></script>
	    
	    <div class="footer text-center">
		    <p>技术支持：<a href="https://webtorrent.io" target="_blank">WebTorrent</a></p>
	    </div>
	</div>

	<div id="player" class="webtor" />
    
    
    
    <script>
	    function setApi(){
		    $("#api").children().remove();
			var apilist = $("#apiList").val().split(/\r?\n/);
			for(var i=0;i<apilist.length;i++){
				$("#api").append("<option>"+apilist[i]+"</option>");
			}
	    }
		$("#apiList").blur(function(){
			setApi();
			$.cookie("apiList",$("#apiList").val());
		});
		// $("#play").click(function(){
		// 	$api = $("#api").val();
		// 	$url = $("#url").val();
		// 	if($url == "" || $url == null || !/^http.*$/.test($url)){
		// 		alert('视频地址不正确！');
		// 		return;
		// 	}
		// 	// if($url == "" || $url == null || !/^http.*=$/.test($api)){
		// 	// 	alert('无效API！');
		// 	// 	return;
		// 	// }
		// 	// window.open($api+$url);
		// });
	    function init(){
		    var ckapi = $.cookie("apiList");
		    if(ckapi && ckapi != ""){
			    $("#apiList").val(ckapi);
		    }
		    setApi();
	    }
	    init();
      function setDefault(){
        $.cookie("apiList","");
        window.location.reload();
      }
    </script>

</body>
</html>
